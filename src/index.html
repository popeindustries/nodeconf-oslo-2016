<!DOCTYPE html>
<html class="">
<head>
  <meta charset="utf-8">
  <title>NodeConf Oslo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
  <link rel="stylesheet" type="text/css" href="index.css">
  <link rel="stylesheet" type="text/css" href="src/lib/monokai.css">
</head>
<body>
  <div class="slides">
    <section id="title">
      <div class="top">
        <h1>Thunder</h1>
      </div>
      <div class="middle">
        <h1>&amp;</h1>
      </div>
      <div class="bottom">
        <h1>Lightning</h1>
      </div>
      <div class="notes">
        <p class="note">Hi, I'm Alex, and I'm here today to talk about thunder, lightning, and the weather</p>
      </div>
    </section>

    <section id="history">
      <img class="logo logo--yr" inline src="src/images/logo-yr--circle.svg">
      <div class="partner-logos">
        <img class="logo logo--nrk" inline src="src/images/logo-nrk.svg">
        <img class="logo logo--met" inline src="src/images/logo-met.svg">
      </div>
      <h2 class="max-users">9,000,000 users/week</h2>
      <img class="stats" inline src="src/images/stats.svg">
      <h2 class="launch-date">Sept 19, 2007</h2>
      <h2 class="mobile-users">60% mobile</h2>
      <div class="notes">
        <p class="note">Yr (or Y-R in English, I guess) is a Norwegian weather service</p>
        <p class="note step">I's a collaboration between Norway's state broadcaster, NRK, (where I work) and the state Meteorological Institute, Met</p>
        <p class="note">NRK and Met have collaborated to deliver weather reports to Norwegians since forever, first via radio, then TV</p>
        <p class="note">In 2007, shortly after Met committed itself to making all it's data freely available to everyone, they released yr.no</p>
        <p class="note step">The service quickly became one of the most used in Norway...</p>
        <p class="note step">...and last summer had 9 million (unique) visitors per week...</p>
        <p class="note step">...of which roughly 60% was mobile traffic (evenly split between web and native apps)</p>
      </div>
    </section>

    <section id="geography">
      <img class="map" inline src="src/images/map.svg">
      <h2 class="title">web sessions (2015)</h2>
      <h3 class="no-users">578,850,000 from Norway (47%)</h3>
      <h3 class="nk-users">31 from North Korea</h3>
      <div class="notes">
        <p class="note">Now, there are only 5 million people living in Norway, so the question is "where did all this traffic come from?"</p>
        <p class="note step">According to Google, the answer would be everywhere except, apparently, Western Sahara</p>
        <p class="note step">Norway accounts for a little under 50% of traffic, with most of the remaining top 10 coming from northern Europe. </p>
        <p class="note">Strangely, we are big with South African farmers, and though we are <em>not</em> so big in Japan...</p>
        <p class="note step">...we did record 31 sessions from North Korea, so maybe that counts as big in North Korea</p>
      </div>
    </section>

    <section id="mobile">
      <div class="phone n95">
        <figure class="back ">
          <img src="src/images/n95-old.png">
          <figcaption>2007</figcaption>
        </figure>
      </div>
      <div class="phone iphone">
        <figure class="front">
          <img src="src/images/iphone-old.png">
          <figcaption>2012</figcaption>
        </figure>
        <figure class="back">
          <img src="src/images/iphone-old-www.png">
          <figcaption>2012</figcaption>
        </figure>
      </div>
      <div class="m">
        <h2>m.yr.no</h2>
        <ul>
          <li class="good">light on bandwidth</li>
          <li class="good">flexible width</li>
          <li class="bad">light on features</li>
        </ul>
      </div>
      <div class="www">
        <h2>www.yr.no</h2>
        <ul>
          <li class="good">heavy on features</li>
          <li class="bad">heavy on bandwidth</li>
          <li class="bad">fixed width</li>
        </ul>
      </div>
      <div class="notes">
        <p class="note"></p>
        <p class="note step">In 2007, if you fired-up out your top-of-the-line Nokia N95, the website would have looked something like this</p>
        <p class="note step">Unfortunately, in 2012, if you fired-up your top-of-the-line iPhone, it would still have looked something like this...</p>
        <p class="note step">...though with a little bit of work, you could opt for the desktop version instead</p>
        <p class="note step">The mobile version had a lot going for it: it was light on bandwidth, and it worked well on small screens, but it was also very light on features</p>
        <p class="note step">The desktop version, on the other hand: is heavy on features and content, but also heavy on bandwidth, and not responsive to screen size at all</p>
        <p class="note step">Although mobile represented only 1/3 of traffic at that time, it was obvious that Yr needed to do a better job for mobile web users</p>
        <p class="note">A plan was made to make the web offering more mobile friendly, starting with a mobile site optimized for the devices of the day, and eventually growing to replace the traditional "desktop" version</p>
      </div>
    </section>

    <section id="architecture">
      <div class="bg"></div>
      <div class="diagram-group">
        <div class="diagram old">
          <svg width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
            <circle class="renderer" opacity="0.5" cx="50" cy="50" r="50"/>
            <circle class="renderer" opacity="0.7" cx="50" cy="50" r="45"/>
            <circle class="renderer" cx="50" cy="50" r="40"/>
            <circle class="api" cx="50" cy="50" r="35"/>
            <circle class="data" cx="50" cy="50" r="30"/>
            <g class="text">
              <circle fill="none" cx="50" cy="50" r="60"/>
              <line x1="98" y1="12" x2="105" y2="5" />
              <line x1="110" y1="47" x2="120" y2="47" />
              <line x1="103" y1="82" x2="110" y2="89" />
              <text opacity="0.6" x="105" y="5">DATA</text>
              <text opacity="0.6" x="120" y="52">API</text>
              <text opacity="0.6" x="110" y="100">RENDERERS</text>
            </g>
          </svg>
        </div>
        <aside class="old-aside">
          <h3>no tests!</h3>
          <h3>2 week pre-release staging!</h3>
        </aside>
      </div>
      <div class="diagram new-renderer">
        <svg width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
          <circle class="renderer" cx="50" cy="50" r="25"/>
          <g class="text">
            <circle class="ring" fill="none" cx="50" cy="50" r="35"/>
            <line x1="76" y1="72" x2="85" y2="81" />
            <text opacity="0.6" x="85" y="92">RENDERER</text>
          </g>
        </svg>
      </div>
      <div class="diagram new-api">
        <svg width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
          <circle class="api" cx="50" cy="50" r="20"/>
          <circle class="api api-2" cx="50" cy="50" r="25"/>
          <g class="text">
            <circle fill="none" cx="50" cy="50" r="35"/>
            <line x1="85" y1="50" x2="98" y2="50" />
            <text opacity="0.6" x="95" y="56">API</text>
          </g>
        </svg>
      </div>
      <div class="diagram new-data">
        <svg width="100px" height="100px" viewBox="0 0 100 100" xml:space="preserve">
          <circle class="data" cx="50" cy="50" r="25"/>
          <g class="text">
            <circle fill="none" cx="50" cy="50" r="35"/>
            <line x1="73" y1="24" x2="80" y2="17" />
            <text opacity="0.6" x="80" y="17">DATA</text>
          </g>
        </svg>
      </div>
      <div class="notes">
        <p class="note">In 2013, I joined the 3 person strong developer team as a front-end developer and designer</p>
        <p class="note">Much of the code base at that time dated from the last redesign in 2010, though you could still find some code from the original version if you dug deep enough</p>
        <p class="note step">Picture a large data layer wrapped in a layer of XML, with several view layers for rendering mobile pages, desktop pages, app embedded views, svgs, pdfs, and probably a lot more!</p>
        <p class="note">It's a bit unintuitive, but there is very little weather related stuff happening here. Weather data comes from Met, and is largely indexed by lat/long coordinate, so a large chunk of the application deals with matching a coordinate to a city, ski hill, your street, or any one of roughly 10 million places around the world</p>
        <p class="note">The application was reliable, and had proven itself for many years, but obviously, it was difficult to update or change</p>
        <p class="note step">To make things worse, there were very few tests of any kind (it was <em>email-driven-development</em>: users would send us error reports and regressions), and there was a 2 week delay to verify releases</p>
        <p class="note step">Naturally, in our eagerness to "do it right this time", we decided to start over</p>
        <p class="note step">The first job was to pull out all the place name data into it's own service. This also made it available for other projects at NRK to consume, and I think the plan is to eventually release it to the public</p>
        <p class="note step">The next step, was to build a REST API and view renderer for the new, responsive layout</p>
        <p class="note">Although this was already a big improvement, and we were using GIT and a CI server to run tests and deploy to the cloud, I was delivering static markup to my colleague, BÃ¥rd, to implement, and that just felt wrong!</p>
        <p class="note step">So after a lot of grumbling and a skunkworks prototype, we split the API and view renderer into separate projects</p>
        <p class="note step">Now we each had our own monolith</p>
      </div>
    </section>

    <section id="universal">
      <div class="bg"></div>
      <div class="titles">
        <h1 class="title title-1">JavaScript <span>up</span></h1>
        <h1 class="title title-2">JavaScript <span>down</span></h1>
        <h1 class="title title-3">JavaScript <span>all the way around</span></h1>
      </div>
      <div class="notes">
        <p class="note">I'm no computer scientist, and I don't know much about <em>real</em> programming languages, but I have spent the last 18 years making things for the web, and I strongly believe in the costs associated with context switching, and the benefits of having full control over the content you create</p>
        <p class="note step">JavaScript on the server and the client is a win-win on both counts, so since late 2014, the view render stack has been back-to-front JavaScript...</p>
        <p class="note step">...or what I like to call: JavaScript Up...</p>
        <p class="note step">...JavaScript Down...</p>
        <p class="note step">...JavaScript All The Way Around</p>
      </div>
    </section>

    <section id="crap">
      <div class="bg"></div>
      <div class="points">
        <h2 class="point point-1">Cacheable</h2>
        <h2 class="point point-2">Resilient</h2>
        <h2 class="point point-3">Accessible</h2>
        <h2 class="point point-4">Progressive</h2>
      </div>
      <div class="notes">
        <p class="note">
        At that time, it wouldn't have been totally crazy to opt for client-only rendering, but from the very beginning our goal has been to render on the server on first request, with subsequent requests handled directly by the client</p>
        <p class="note">We feel this pattern best matches our content while providing an optimal experience for all our users</p>
        <p class="note">Specifically, it's...</p>
        <p class="note step">...cacheable. Most of the forecast data we get from Met expires hourly, so the cost of that server render can be spread over many requests. It's also...</p>
        <p class="note step">...resilient. The browser is hostile territory, and bad things happen all the time, so being able to show content when things are blowing up is an advantage. And it's...</p>
        <p class="note step">...accessible. Not all devices are created equal (in 2015 we had visits from 11,996 different ones), and server-side rendering allows us to deliver content to as many of them as possible. And lastly, it's...</p>
        <p class="note step">...progressive. Delivering a decent baseline experience allows us to add additional features, and improve that experience, if a device supports it</p>
        <p class="note step">Basically, it's CRAP! It might not be a hip acronym like SPA, AMP, or PWA, but let's be honest, most of us love crap. We eat crap, we watch crap, and we spend a lot of time looking at crap on our phones. But seriously, this model is so CRAP it's awesome</p>
        <p class="note step">As a developer, this universal JavaScript thing is fantastic because it really minimizes the costs associated with context switching, while at the same time giving you full control over your content</p>
      </div>
    </section>

    <section id="express">
      <div class="bg"></div>
      <pre class="code app">
        <code class="js">
          const app = express();
        </code>
      </pre>
      <pre class="code middleware">
        <code class="js">
          app.use(function (req, res, next) {
            log('request from: ' + req.originalUrl);
            next();
          });
        </code>
      </pre>
      <pre class="code param">
        <code class="js">
          app.param('localeCode', function (req, res, next, localeCode) {
            if (valid(localeCode)) return next();
            return next(Error('invalid locale code'));
          });
        </code>
      </pre>
      <pre class="code route">
        <code class="js">
          const pattern = '/:localeCode({localeCode})/:page({page})';

          app.get(pattern, function (req, res, next) {
            const localeCode = req.params.localeCode;
            const query = req.query;
            //...
          });
        </code>
      </pre>
      <pre class="code runtime">
        <code class="js">
          const thing = runtime.isServer
            ? require('thing-server.js')
            : require('thing-client.js');
        </code>
      </pre>
      <h2 class="coverage">80% shared code</h2>
      <div class="notes">
        <p class="note">At the time, I thought this was such an amazing idea, and I was so excited, that I ended up porting Express.js to run in the browser</p>
        <p class="note step">So whether it's initializing an application...</p>
        <p class="note step">...or adding middleware...</p>
        <p class="note step">...or adding request param validation...</p>
        <p class="note step">...or handling a request...</p>
        <p class="note step">Thunder ...it works the same on the server as it does in the browser</p>
        <p class="note">The initial trigger is different, of course (the HTTP pipeline in Node, and the History API in the browser), but the logic abstractions are the same: get an url, route it to a logic handler, munge some data, and render</p>
        <p class="note step">Sometimes we do have to do a little of this...</p>
        <p class="note step">...but overall we are able to share 80% of our code between the two environments</p>
        <p class="note">That's wonderful for us as developers, but it's also CRAP for our users (remembering of course that CRAP is awesome).</p>
        <p class="note">By representing state as URLs, and by using anchor tags to link between sections, disabling JavaScript, or using a device that doesn't pass our mustard test, just works</p>
      </div>
    </section>
  </div>
  <script src="src/lib/highlight.js"></script>
  <script src="index.js"></script>
</body>
</html>